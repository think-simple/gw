<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gebrauchtwagen-Check ‚Äì VW Polo 1.0 TSI</title>
<meta name="theme-color" content="#003366">
<style>
  :root { color-scheme: light dark; }
  body {
    font-family: Arial, sans-serif;
    background: #f2f6fc;
    color: #111827;
    margin: 0;
    padding: 12px 12px 40px 12px;
  }
  h1 {
    color:#003366;
    font-size:22px;
    text-align:center;
    margin: 6px 0 10px 0;
  }
  h2 {
    font-size:17px;
    margin-top:18px;
    margin-bottom:6px;
    color:#0055A4;
    border-left:4px solid #0055A4;
    padding-left:8px;
  }
  .toolbar {
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    margin: 4px 0 10px 0;
    justify-content:center;
  }
  .btn {
    border:none;
    border-radius:999px;
    padding:7px 12px;
    font-size:13px;
    background:#0055A4;
    color:white;
    display:inline-flex;
    align-items:center;
    gap:6px;
    box-shadow:0 1px 3px rgba(0,0,0,0.2);
  }
  .btn-secondary { background:#0f766e; }
  .btn-danger { background:#b91c1c; }
  .btn span.icon { font-size:15px; }
  #app {
    max-width: 800px;
    margin: 0 auto;
  }
  .item {
    background:#ffffff;
    padding:10px;
    border-radius:10px;
    margin:6px 0;
    box-shadow:0 1px 3px rgba(0,0,0,0.12);
    font-size:14px;
  }
  .item-header { display:flex; align-items:flex-start; }
  .item input[type=checkbox] {
    width:20px;
    height:20px;
    margin-right:10px;
  }
  .label-text { flex:1; }
  .note { display:none; margin-top:6px; }
  .note-label {
    font-size:12px;
    margin-bottom:4px;
    color:#374151;
  }
  .note textarea {
    width:100%;
    min-height:70px;
    padding:6px;
    border-radius:8px;
    border:1px solid #cbd5f5;
    font-size:13px;
    box-sizing:border-box;
  }
  .photo { margin-top:6px; }
  .photo-label {
    font-size:12px;
    margin-bottom:4px;
    color:#374151;
  }
  .photo input[type=file] { font-size:12px; }
  .photo-preview {
    margin-top:4px;
    max-width:100%;
    max-height:140px;
    border-radius:8px;
  }
  small.hint {
    display:block;
    font-size:11px;
    color:#6b7280;
    margin-top:2px;
  }
  @media (prefers-color-scheme: dark) {
    body { background:#020617; color:#e5e7eb; }
    h1 { color:#bfdbfe; }
    h2 { color:#bfdbfe; border-left-color:#3b82f6; }
    .item {
      background:#020617;
      box-shadow:0 1px 4px rgba(0,0,0,0.8);
    }
    .note textarea {
      background:#020617;
      color:#e5e7eb;
      border-color:#374151;
    }
    .photo-preview { border:1px solid #1f2937; }
  }
</style>
</head>
<body>
<h1>Gebrauchtwagen-Check ‚Äì VW Polo 1.0 TSI</h1>

<div class="toolbar">
  <button class="btn" onclick="exportPDF()"><span class="icon">üìÑ</span><span>PDF / Drucken</span></button>
  <button class="btn" onclick="exportCSV()"><span class="icon">üìä</span><span>CSV exportieren</span></button>
  <button class="btn btn-secondary" onclick="exportWhatsApp()"><span class="icon">üì≤</span><span>WhatsApp-Zusammenfassung</span></button>
  <button class="btn" onclick="backupData()"><span class="icon">‚òÅÔ∏è</span><span>Backup-Datei</span></button>
  <button class="btn btn-secondary" onclick="restoreData()"><span class="icon">üìÇ</span><span>Backup einspielen</span></button>
  <button class="btn btn-danger" onclick="resetAll()"><span class="icon">üóëÔ∏è</span><span>Alles zur√ºcksetzen</span></button>
</div>

<div id="app"></div>

<input type="file" id="backupFileInput" accept="application/json" style="display:none" />

<script>
(function(){
  var sections = [
    {
      key: "vor",
      title: "üöó Vor der Probefahrt ‚Äì Au√üen & Innen",
      items: [
        "Karosserie: Dellen, Kratzer, Spaltma√üe pr√ºfen",
        "LED-Scheinwerfer & R√ºckleuchten pr√ºfen",
        "Reifenprofil & Abrieb kontrollieren",
        "Felgen auf Sch√§den pr√ºfen",
        "Sportfahrwerk / D√§mpfer auf √ñlspuren pr√ºfen",
        "Innenraum: Sitze, Lenkrad, Schalter pr√ºfen",
        "R√ºckfahrkamera & Display testen"
      ]
    },
    {
      key: "motor",
      title: "üõ†Ô∏è Motorraum pr√ºfen",
      items: [
        "√ñlstand & √ñlqualit√§t pr√ºfen",
        "K√ºhlmittelstand & Farbe pr√ºfen",
        "Bremsfl√ºssigkeit hell und frisch?",
        "Keine √ñl-/Wasserlecks am Motor/Turbo",
        "Schl√§uche & Leitungen ohne Risse",
        "Keilriemen Zustand pr√ºfen"
      ]
    },
    {
      key: "fahrt",
      title: "üß≠ W√§hrend der Probefahrt",
      items: [
        "Motorlauf ruhig ‚Äì kein Ruckeln",
        "Turbo sauber ohne laute Pfeifger√§usche",
        "Schalten problemlos in alle G√§nge",
        "Kupplung ruckfrei, Schleifpunkt plausibel",
        "Fahrwerk ohne Poltern oder Klappern",
        "Lenkung pr√§zise, kein Ziehen",
        "Bremsen ohne Rubbeln oder Ger√§usche",
        "Assistenzsysteme & PDC funktionieren"
      ]
    },
    {
      key: "nach",
      title: "üîç Nach der Probefahrt",
      items: [
        "Keine ungew√∂hnlichen Ger√ºche (√ñl/K√ºhlmittel)",
        "Motorger√§usche nach Abstellen pr√ºfen",
        "OBD-Fehlerspeicher auslesen",
        "Servicehistorie vollst√§ndig & plausibel",
        "Z√ºndkerzen bei ~60.000 km erneuert?",
        "Bremsfl√ºssigkeit aktuell?"
      ]
    },
    {
      key: "deal",
      title: "üí∂ Privatkauf & Verhandlung",
      items: [
        "Fahrzeugbrief/Zulassung pr√ºfen",
        "VIN mit Karosserie & Dokumenten vergleichen",
        "Wartungsnachweise & √ñlwechselintervalle pr√ºfen",
        "Unfallfreiheit schriftlich best√§tigen lassen",
        "Marktpreis vergleichen & realistisch einordnen",
        "M√§ngel dokumentieren ‚Üí Preisnachlass fordern"
      ]
    }
  ];

  var storageOK = true;
  try {
    var t = "__gwc_test__";
    window.localStorage.setItem(t, "1");
    window.localStorage.removeItem(t);
  } catch(e) {
    storageOK = false;
  }

  function storageKey(id, suffix) {
    return "gwc_" + id + "_" + suffix;
  }

  function loadState(key) {
    if (!storageOK) return "";
    try { return window.localStorage.getItem(key) || ""; } catch(e) { return ""; }
  }

  function saveState(key, value) {
    if (!storageOK) return;
    try { window.localStorage.setItem(key, value); } catch(e) {}
  }

  function buildUI() {
    var app = document.getElementById("app");
    if (!app) return;
    app.innerHTML = "";

    for (var s = 0; s < sections.length; s++) {
      var sec = sections[s];
      var h2 = document.createElement("h2");
      h2.textContent = sec.title;
      app.appendChild(h2);

      for (var i = 0; i < sec.items.length; i++) {
        var itemText = sec.items[i];
        var idBase = sec.key + "_" + i;

        var itemDiv = document.createElement("div");
        itemDiv.className = "item";

        var header = document.createElement("div");
        header.className = "item-header";

        var cb = document.createElement("input");
        cb.type = "checkbox";
        cb.id = idBase + "_cb";

        var checkedVal = loadState(storageKey(idBase, "checked"));
        if (checkedVal === "1") cb.checked = true;

        var labelSpan = document.createElement("span");
        labelSpan.className = "label-text";
        labelSpan.textContent = itemText;

        header.appendChild(cb);
        header.appendChild(labelSpan);
        itemDiv.appendChild(header);

        var noteDiv = document.createElement("div");
        noteDiv.className = "note";

        var noteLabel = document.createElement("div");
        noteLabel.className = "note-label";
        noteLabel.textContent = "Bemerkungen / Beobachtungen:";
        noteDiv.appendChild(noteLabel);

        var ta = document.createElement("textarea");
        ta.id = idBase + "_note";
        ta.value = loadState(storageKey(idBase, "note"));
        noteDiv.appendChild(ta);

        var photoDiv = document.createElement("div");
        photoDiv.className = "photo";

        var photoLabel = document.createElement("div");
        photoLabel.className = "photo-label";
        photoLabel.textContent = "Foto (optional, z. B. Schaden):";
        photoDiv.appendChild(photoLabel);

        var fileInput = document.createElement("input");
        fileInput.type = "file";
        fileInput.accept = "image/*";
        fileInput.id = idBase + "_file";
        photoDiv.appendChild(fileInput);

        var hint = document.createElement("small");
        hint.className = "hint";
        hint.textContent = "Hinweis: Fotos werden lokal im Browser gespeichert (evtl. Speicherbegrenzung).";
        photoDiv.appendChild(hint);

        var img = document.createElement("img");
        img.className = "photo-preview";
        img.id = idBase + "_img";
        var savedPhoto = loadState(storageKey(idBase, "photo"));
        if (savedPhoto) {
          img.src = savedPhoto;
        } else {
          img.style.display = "none";
        }
        photoDiv.appendChild(img);

        noteDiv.appendChild(photoDiv);
        itemDiv.appendChild(noteDiv);

        if (cb.checked) noteDiv.style.display = "block";

        (function(idBase, cb, noteDiv, ta, fileInput, img){
          cb.addEventListener("change", function(){
            saveState(storageKey(idBase, "checked"), cb.checked ? "1" : "0");
            noteDiv.style.display = cb.checked ? "block" : "none";
          });

          ta.addEventListener("input", function(){
            saveState(storageKey(idBase, "note"), ta.value);
          });

          fileInput.addEventListener("change", function(){
            var file = fileInput.files && fileInput.files[0];
            if (!file) {
              saveState(storageKey(idBase, "photo"), "");
              img.style.display = "none";
              img.removeAttribute("src");
              return;
            }
            var reader = new FileReader();
            reader.onload = function(ev) {
              var dataUrl = ev.target.result;
              img.src = dataUrl;
              img.style.display = "block";
              saveState(storageKey(idBase, "photo"), dataUrl);
            };
            reader.readAsDataURL(file);
          });
        })(idBase, cb, noteDiv, ta, fileInput, img);

        app.appendChild(itemDiv);
      }
    }
  }

  window.exportPDF = function(){
    window.print();
  };

  window.exportCSV = function(){
    var lines = ['"Bereich","Punkt","Erledigt","Bemerkung"'];
    for (var s = 0; s < sections.length; s++) {
      var sec = sections[s];
      for (var i = 0; i < sec.items.length; i++) {
        var itemText = sec.items[i];
        var idBase = sec.key + "_" + i;
        var cb = document.getElementById(idBase + "_cb");
        var ta = document.getElementById(idBase + "_note");
        var done = cb && cb.checked ? "Ja" : "Nein";
        var note = ta ? ta.value.replace(/"/g,'""') : "";
        var line = '"' + sec.title.replace(/"/g,'""') + '","' +
                   itemText.replace(/"/g,'""') + '","' +
                   done + '","' + note + '"';
        lines.push(line);
      }
    }
    var csv = lines.join("\n");
    var blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
    var url = URL.createObjectURL(blob);
    var a = document.createElement("a");
    a.href = url;
    a.download = "gebrauchtwagen-check.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };

  window.exportWhatsApp = function(){
    var text = "Gebrauchtwagen-Check ‚Äì Zusammenfassung%n%n";
    for (var s = 0; s < sections.length; s++) {
      var sec = sections[s];
      text += sec.title + "%n";
      for (var i = 0; i < sec.items.length; i++) {
        var itemText = sec.items[i];
        var idBase = sec.key + "_" + i;
        var cb = document.getElementById(idBase + "_cb");
        var ta = document.getElementById(idBase + "_note");
        if (cb && cb.checked) {
          text += "‚úî " + itemText;
          if (ta && ta.value) {
            text += " ‚Äì " + ta.value;
          }
          text += "%n";
        }
      }
      text += "%n";
    }
    var finalText = text.replace(/%n/g, "\n");
    var url = "https://wa.me/?text=" + encodeURIComponent(finalText);
    window.open(url, "_blank");
  };

  window.resetAll = function(){
    if (!window.confirm("Wirklich alle Haken, Notizen und Fotos l√∂schen?")) return;
    if (storageOK) {
      try {
        for (var i = window.localStorage.length - 1; i >= 0; i--) {
          var k = window.localStorage.key(i);
          if (k && k.indexOf("gwc_") === 0) {
            window.localStorage.removeItem(k);
          }
        }
      } catch(e) {}
    }
    buildUI();
  };

  window.backupData = function(){
    var data = {};
    if (storageOK) {
      try {
        for (var i = 0; i < window.localStorage.length; i++) {
          var k = window.localStorage.key(i);
          if (k && k.indexOf("gwc_") === 0) {
            data[k] = window.localStorage.getItem(k);
          }
        }
      } catch(e) {}
    }
    var json = JSON.stringify(data, null, 2);
    var blob = new Blob([json], {type:"application/json;charset=utf-8;"});
    var url = URL.createObjectURL(blob);
    var a = document.createElement("a");
    a.href = url;
    a.download = "gebrauchtwagen-check-backup.json";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    alert("Backup-Datei gespeichert. Diese kannst du z. B. in iCloud Drive oder Google Drive ablegen.");
  };

  window.restoreData = function(){
    var input = document.getElementById("backupFileInput");
    input.value = "";
    input.onchange = function(){
      var file = input.files && input.files[0];
      if (!file) return;
      var reader = new FileReader();
      reader.onload = function(ev){
        try {
          var obj = JSON.parse(ev.target.result);
          if (storageOK) {
            for (var k in obj) {
              if (obj.hasOwnProperty(k) && k.indexOf("gwc_") === 0) {
                window.localStorage.setItem(k, obj[k]);
              }
            }
          }
          buildUI();
          alert("Backup erfolgreich eingespielt.");
        } catch(e) {
          alert("Backup konnte nicht gelesen werden.");
        }
      };
      reader.readAsText(file);
    };
    input.click();
  };

  function init(){
    buildUI();
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }
})();
</script>
</body>
</html>
